//IMPORT AUTOMATICO

//POR FAVOR PULE PARA DEPOIS DOS IMPORTS

//
var roi = 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-44.584740215116334, -21.28235772722951],
          [-44.584740215116334, -21.37030641437444],
          [-44.4237218435343, -21.37030641437444],
          [-44.4237218435343, -21.28235772722951]]], null, false),
    landsat = ee.ImageCollection("LANDSAT/LC08/C02/T1_TOA"),
    water = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Feature(
        ee.Geometry.MultiPoint(
            [[-44.527216234991826, -21.333583533383386],
             [-44.527216234991826, -21.33894004611535],
             [-44.5492747219303, -21.338860099602154],
             [-44.54953221399573, -21.34333703722502],
             [-44.553480425665654, -21.319431805255316],
             [-44.55785779077796, -21.3125553318346],
             [-44.56755665857581, -21.3125553318346],
             [-44.57502392847327, -21.308397307972317],
             [-44.582405367682256, -21.329426105109917],
             [-44.552526853244736, -21.342585031902875],
             [-44.55089607016368, -21.351218784151904],
             [-44.5533851601295, -21.35681446306732],
             [-44.55535926596446, -21.36360892875719],
             [-44.563513181369736, -21.366486489813884],
             [-44.565744779270126, -21.367845318437997],
             [-44.52746429220958, -21.35993196291779],
             [-44.523344419162704, -21.362889529659675],
             [-44.50265922323985, -21.34930021648377],
             [-44.47450107917782, -21.337908203823563],
             [-44.57157057038469, -21.29385589793421],
             [-44.57101267090959, -21.29677481200197],
             [-44.564146215831464, -21.2979743489231],
             [-44.568094427501386, -21.301093099098864],
             [-44.548474693322824, -21.303798878801256],
             [-44.54100742342536, -21.30339905009655],
             [-44.54186573031013, -21.304118740981632],
             [-44.536243820214914, -21.306177837097064],
             [-44.5381320953614, -21.30637774780432],
             [-44.51389565470283, -21.32486831156698],
             [-44.5131875515229, -21.329825385743224]]),
        {
          "class": 0,
          "name": "water",
          "system:index": "0"
        }),
    farming = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Feature(
        ee.Geometry.MultiPoint(
            [[-44.53409845102399, -21.29448393931048],
             [-44.533068482762275, -21.295823442445048],
             [-44.494608395503974, -21.31604446877659],
             [-44.498556607173896, -21.31220638826969],
             [-44.49143266003034, -21.317563681263724],
             [-44.491346829341865, -21.322361091176777],
             [-44.49392174999616, -21.294613902745162],
             [-44.497354977535224, -21.297332879019653],
             [-44.43845561127868, -21.305009716975707],
             [-44.44781115632262, -21.29677309389827],
             [-44.4548492727777, -21.293414338399884],
             [-44.428403454365764, -21.34314805532954],
             [-44.45494480844568, -21.35457962983879],
             [-44.46026631113123, -21.354659567780136],
             [-44.467304427586306, -21.359295893765093],
             [-44.47563000436853, -21.359615634977004],
             [-44.474857528172244, -21.365930380914254],
             [-44.49783170391238, -21.352243596172887],
             [-44.547441841851835, -21.35983762695221],
             [-44.56025265458847, -21.327050308492378],
             [-44.561969268358, -21.32337242574724],
             [-44.52780865434433, -21.28640208753334],
             [-44.545575606858975, -21.28768168351348],
             [-44.54186990254523, -21.32650920661318],
             [-44.52418878071906, -21.317953957857803],
             [-44.57740380757453, -21.34425775797349],
             [-44.579206252032535, -21.33514390524347],
             [-44.57585885518195, -21.327148831344786],
             [-44.57637383931281, -21.359686059324545],
             [-44.54616143696906, -21.353051289391214]]),
        {
          "class": 1,
          "name": "farming",
          "system:index": "0"
        }),
    forest = 
    /* color: #00ffff */
    /* shown: false */
    ee.Feature(
        ee.Geometry.MultiPoint(
            [[-44.45273473256232, -21.34450889382242],
             [-44.45239140980841, -21.344868638930393],
             [-44.4562967061341, -21.348026363664292],
             [-44.45702626698615, -21.349225481820355],
             [-44.56476482075327, -21.334260326152382],
             [-44.56624540012949, -21.331961773185164],
             [-44.57047256153696, -21.327444511996653],
             [-44.57450660389536, -21.318103484311983],
             [-44.564460022601814, -21.287968393272298],
             [-44.53729460969898, -21.28992774921733],
             [-44.53613589540455, -21.29024764158613],
             [-44.43879917668187, -21.311081541445553],
             [-44.438423667419784, -21.311841175325927],
             [-44.43284467266881, -21.309152453539696],
             [-44.42709401654088, -21.30661361530048],
             [-44.504110178032164, -21.326313577643536],
             [-44.50295146373773, -21.327472896962234],
             [-44.50353082088495, -21.326313577643536],
             [-44.51282699033143, -21.365305270044388],
             [-44.52316958829286, -21.35487375814916],
             [-44.522032331670545, -21.35413433160863],
             [-44.50591715879339, -21.290820718427966],
             [-44.50542363233465, -21.29218024793139],
             [-44.48229673806998, -21.294033636684574],
             [-44.482082161348785, -21.297272424305586],
             [-44.48191049997183, -21.299271640299615],
             [-44.4637143940148, -21.303829751070367],
             [-44.46242693368765, -21.300950960717405],
             [-44.45827098059509, -21.32748708253404],
             [-44.458592845676876, -21.32828660768521]]),
        {
          "class": 2,
          "name": "forest",
          "system:index": "0"
        }),
    mg = ee.FeatureCollection("users/rodrigozonzin/limites_municipais/MG_Municipios_2021");

//RECOMECE A LEITURA DO CODIGO DAQUI

Map.addLayer(roi); 
var carrancas = mg.filter('NM_MUN == "Itutinga"');
//Map.addLayer(mg); 

landsat = landsat.filterBounds(roi)
            .filterMetadata('CLOUD_COVER', 'less_than', 0.05)
            .map(function(img){return img.clip(roi)}); 
            
//print(landsat);

var img = ee.Image('LANDSAT/LC08/C02/T1_TOA/LC08_218075_20220903').clip(roi);

var sample = ee.FeatureCollection(water).merge(farming).merge(forest); 
var bandas = ['B4', 'B3', 'B2']; 

var treinamento = img.select(bandas).sampleRegions({
  collection: sample,
  properties: ['class'],
  scale: 30
}); 

var classificador = ee.Classifier.smileRandomForest({numberOfTrees: 15}).train({
  features: treinamento,
  classProperty: 'class',
  inputProperties: bandas
}); 

var classificacao = img.select(bandas).classify(classificador); 

//Map.addLayer(sample); 

Map.addLayer(img, {min: 0.0, max: 0.4, bands: ['B4', 'B3', 'B2']}, "IMAGEM");
Map.addLayer(classificacao, {min: 0, max:2, palette:['blue', 'yellow', 'green']}, "classificacao");

print(img.getThumbURL({
  params: {
    //dimensions:
    bands: bandas,
    min: 0.0,
    max: 0.4,
    region: roi, 
    format: 'PNG'
  },
  //callback:
}));

print(classificacao.getThumbURL({
  params: {
    min: 0,
    max:2,
    palette: ['blue', 'yellow', 'green'],
    region: roi,
    format: 'PNG'
  }
}));
